---
2024.11.18  
[对照面经](https://www.nowcoder.com/discuss/596064413442949120)

#### 项目架构:
公司lw引擎+公共代码+项目代码  

引擎提供游戏的基础共功能模型,特效,资源加载,场景,摄像机,光照声音,网络等基础功能  

公共进行了一些各项目共用常用的模块封装: 登录,网关,UI封装,屏蔽字,防成谜,实名认证,邮箱,充值等  

项目代码整体情况:  

1.状态同步
  - [状态同步/帧同步](同步模式.md)
  通过协议的方式与服务端拟定协议事务,进行状态同步

2.代码框架:MVC,ECS,ECGame
  - [MVC,MVP,MVVP](项目框架.md#mvcmvpmvvm)  
    大部分业务,包括UI模块都是用MVC的形式组织起来,不好的一点是出现了模块嵌套,但并非mvc本身问题,mvc本身可能存在没有必要存在view或者model的情况和ctrl臃肿
  - [ECS](项目框架.md#ecs)  
    战斗相关的业务用ECS进行改版尝试,服务端是用的ECS,为了与服务端同步好进行属性同步,同时方便的卸载加载组件,以及代码结构简单,但调试还不太方便
    
3.用到的设计模式：  
  - [单例](设计模式.md)  
  - [观察者](设计模式.md)  
  - [策略模式](设计模式.md)  
  - [指令模式](设计模式.md)

4.代码管理:
  svn,传统,co,update,reverse,merge,commit
  工具少量git(fetch,pull,push,merge,commit):  
  - 云效ci/cd蓝图  

5.开发流程:
  - 项目自行检出引擎工程进行编译(bat执行Cmake,ide编译工程,ide版本要求),编译过程中可以配置一些操作启用禁用,自定义拓展引擎功能(在引擎c层上开发,一般是效率考虑)  
  
  - 专门的公共代码检出和更新工具,检查版本和依赖进行公告脚本代码更新
  
  - 各种编辑器(没有集中):  
    数据编辑器(导表): 做了一些封装,用他的规则就可以对数据文件自定义解析,一般解析为py文件格式是字典等可以直接加载数据类型或者类化为对象再自定义一些工厂函数使用
    
    UI编辑器: 记录UI控件布局为配置文件,再解析为py的指令文件,继承UI对象的时候用指定文件路径名的方式执行布局指令集来初始化UI,将存粹UI布局隐藏独立开后又方便的在下方可以编写view相关的操作逻辑且还内聚为view 

    法术编辑器: 针对操作的都是引擎基础节点的公共方法,比如播动画,节点生命周期管理,空间操作,吧这些操作抽象为时间轴,时间轴的集合就是操作的集合,时间轴的时序就是法术播放的时序逻辑,附带condition, 发信号等控制指令就可以编排与外界的交互,对应的法术配置序列文件可以静态话下来以及需要的时候切换和维护,没有用状态机  

    地图编辑器: 2d瓦片地图,在对应的瓦片上放置单位就行,后续增加了一些预制组合之类;随机地图则只需要编辑关键点,联通关系,资源生成模板;  

    资源编辑器: 主要是编辑特效,gfx,mod, 例子发射器(基础元素面片,广告牌等的动画,生命周期,运动轨迹控制的组合),针对模型的材质纹理的周期性调整(UV动画)  
  
  - ci/cd平台: 内外网隔离  
    ci负责一些资源批处理工作,如代码文件化,资源检查(图片清理,模型大小,贴图缺失),资源自动加工(生成索引文件,导表到处)等,依旧处于内网  

    cd是将项目按固定格式组织后用提供的打包脚本吧资源,脚本打包加密为特定文件或者目录后部署在指定的域名下面,然后经过一系列校验手段(文件发布审核,md5+下载url的索引文件发布审核)进行发布到外网,游戏/游戏平台内置会去对比最新的索引文件,发现差异则根据索引内容引导下载更新,用于整包/补丁/工具文件的外网发布

#### 主要模块:  
- 通信  
  ecgame框架:  
  1.主要是封装了与服务端的通信功能,用dll的形式暴露接口给客户端使用
  2.服务器还支持了一个把部分逻辑集成到客户端的功能(打包为脚本文件),他们会通过ci吧他们一部分逻辑(不涉及安全的逻辑,如buff计算推演逻辑)集成到客户端,然后两边公用一份代码,两端都通过协议交互与之交互;共用逻辑,减轻服务端压力.
  通信的形势是拟定协议的方式,给要通信事务进行编号,拟定事务携带的参数类型,数量,用一份特定格式的协议文件进行记录,两端同步每次加新协议就要约定好后同步解析  
  解析出来的是对应事务的py函数,函数做的内容就是将参数压包和解包为协议规定格式的字节流,上层直接调用业务py函数,隐藏了这些字节流压解细节,然后给dll字节流后会用socket进行通信([socket](知识点misc.md)❓)自己实践过一次,但查乱码之类麻烦,后面用引擎封装的([大小端](知识点misc.md#大小端)❓)

- 业务
  - 特效  
    gfx，mod，叠加特效(❓),指令模式(❓)+组合模式  
    特效有一份完整的游戏资源目录：tex，model，mod/gfx嵌套？？
  
  - 模型：  
    1. 前期的模型规范，参考其他项目组和主观感受，原先2w顶点，面数(❓),定制依据(❓),后面定制为(❓)
    2. 角色对象的封装：
       ![image](https://github.com/user-attachments/assets/122a4600-1c15-4085-b89f-59e4ac7977a2)  

  - 战斗
 
  - UI系统/管理/优化/携程应用
    - 分辨率适配UI
    - 2^n尺寸
 
  - 场景管理
    - 状态机
    - 流程
 
  - 地图
    - 地图生成
   
    - 渲染TileMap
   
    - 寻路
   
    - 性能
   
  - C交互
 
  - 工具
     - 自动打包提交

- 资源

- 打包相关

- 热更

- 代码管理

- 上线相关

- 性能优化

- GC

渲染知识应用：

- 渲染相关应用
  - 阴影,染色,半透,LUT

- 图集

- dc

- 合批

- 渲染管线

- 对象池

      
---
